
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>


<svg width=960 height=600>
</svg>


<div id="info">
</div>



<script>
var count = 1;
  // Also see TOPOJSON
Promise.all([
  d3.json('world.geojson'),
  d3.csv('csv w rank/Grey_Wolf.csv'),
  d3.csv('csv w rank/Canada_Geese.csv'),
  d3.csv('csv w rank/Galapagos_Tortoises.csv'),
  d3.csv('csv w rank/Great_Whales.csv'),
  d3.csv('csv w rank/Heron_and_Egret.csv'),
  d3.csv('csv w rank/Ringed_Seals.csv'),
  d3.csv('csv w rank/Roe_Deer.csv'),
  d3.csv('csv w rank/Turtle_Doves.csv'),
  d3.csv('csv w rank/Whale_Shark.csv'),
  d3.csv('csv w rank/White_Tailed_Eagle.csv')
]).then( ([countries, cities, geese, tort, whales, heron, seals, deer, doves, shark, eagle]) => {
  createMap(countries,cities, geese, tort, whales, heron, seals, deer, doves, shark, eagle)
})

  function createMap(countries, cities, geese, tort, whales, heron, seals, deer, doves, shark, eagle) {
   // d3.selectAll('circle').remove();
  var proj = d3.geoEquirectangular()
    .translate([250, 250])
    .scale(120);

//  var proj = d3.geoSatellite()
//      .scale(1330)
//      .translate([250,250])
//      .rotate([-30.24, -31, -56])
//      .tilt(15)
//      .distance(1.150)
//      .clipAngle(90);

  var gpath = d3.geoPath()
    .projection(proj);

  var ccolor = 
    d3.scaleSequential( d3.interpolateBlues )
    .domain( 
      d3.extent( countries.features, d => gpath.area(d))
      );


  // draw country boundaries
  d3.select('svg')
    .append('g')
    .attr('id', 'countries')
    .selectAll('path')
    .data(countries.features)
    .enter()
    .append('path')
      .attr('d', function(d) { return gpath(d); })
      .attr('stroke-width', 1)
      .attr('stroke', 'steelblue')
      .attr('id', d => d.id)
      .attr('fill', d => ccolor( gpath.area(d)) );
      
  
   var mapZoom = d3.zoom()
    .on('zoom', zoomed);

  var zoomSettings = d3.zoomIdentity
    .translate(250, 250)
    .scale(120);

  d3.select('svg')
    .call(mapZoom)
    .call(mapZoom.transform, zoomSettings);

  function zoomed(e) {
    proj
      .translate([e.transform.x, e.transform.y])
      .scale(e.transform.k);

    console.log(e.transform.k);

    if( e.transform.k > 400 ) 
      console.log('toggle adaptive map feature');

    // redraw map with new projection settings
    d3.selectAll('path')
      .attr('d', gpath);

    d3.selectAll('circle')
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
  }
  
     d3.select('svg')
      .selectAll('circle1')
      .data(geese.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#645452')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
 
    d3.select('svg')
      .selectAll('circle2')
      .data(cities.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#b2beb5')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });

   d3.select('svg')
      .selectAll('circle3')
      .data(tort.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#8db600')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });

       d3.select('svg')
      .selectAll('circle4')
      .data(whales.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#007fff')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
     d3.select('svg')
      .selectAll('circle5')
      .data(heron.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#ff9966')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
     d3.select('svg')
      .selectAll('circle6')
      .data(seals.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#321414')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
       d3.select('svg')
      .selectAll('circle7')
      .data(deer.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#cd7f32')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
         
    d3.select('svg')
      .selectAll('circle8')
      .data(doves.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '	#ffffff')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
            
     d3.select('svg')
      .selectAll('circle9')
      .data(shark.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy', d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#0000ff')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
            
    d3.select('svg')
      .selectAll('circle10')
      .data(eagle.filter(function(d){ return d.rank == count }))
      .enter()
      .append('circle')
      .attr('r', 10)
      .attr('cx', d => proj([d.x, d.y])[0])
      .attr('cy',  d => proj([d.x, d.y])[1])
      .attr('stroke-width', 1)
      .attr('stroke', '#4F442B')
      .attr('fill', '#ffef00')
      .on('mouseover', function(e, d) {
        console.log("mouseover: "+d);
              d3.select('#info').text(d.name);
            });
    count++;
}
//setInterval(createMap(countries,cities, geese, tort, whales, heron, seals, deer, doves, shark, eagle),100)

</script>
