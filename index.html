<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Alien Abduction</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="topojson.min.js"></script>
    <script src="state-converter.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="overlay">
      <nav>
        <a href="#page-1">1</a>
        <a href="#page-2">2</a>
        <a href="#page-3">3</a>
        <a href="#page-4">4</a>
      </nav>
      <div class="scroll-container">
        <div class="scroll-page" id="page-1">
          <h1>Let's Look At Alien Abductions By The Numbers</h1>
          <br />
          What's In Our Dataset

          <div class="flex-container">
            <div class="container">
              <img
                src="icons/world.png"
                alt="calender"
                width="150"
                height="150"
              />
              <img
                src="icons/stories.png"
                alt="calender"
                width="150"
                height="150"
              />
              <img
                src="icons/timer.png"
                alt="calender"
                width="150"
                height="150"
              />
              <img
                src="aliencursor.png"
                alt="calender"
                width="150"
                height="150"
              />
              <img
                src="icons/cal.png"
                alt="calender"
                width="150"
                height="150"
              />
            </div>
            <div class="container">
              <text
                >Location Information, Text Description of the Abduction,
              </text>
              <text> Duration of the Event, Date and Time, </text>
              <text>Sighting Information (Shapes/Sizes/Flashes) </text>
              <text> 12 Total Columns, 136942 Total Entries </text>
            </div>
          </div>
        </div>

        <div class="scroll-page2" id="page-2">
          Abductions By Location
          <p>Total Reports By US State</p>

          <svg width="960" height="600" id="mapsvg1"></svg>
          <br />
          <p>Likelihood of Abduction By State Capita</p>
          <svg width="960" height="600" id="mapsvg2"></svg>
        </div>

        <div class="scroll-page3" id="page-3">Abductions By Type</div>

        <p>Freqency of UFO Shape From Total Reports</p>
        <div id="shape"></div>

        <script>
          var margin = { top: 30, right: 30, bottom: 70, left: 100 },
            width = 800 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

          const svg = d3
            .select("#shape") //test
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

          var mapMouseover = d3
            .select("body")
            .append("div")
            .attr("class", "maptooltip")
            .style("opacity", 0);

          d3.csv("shape.csv").then(function (data) {
            var x = d3
              .scaleBand()
              .range([0, width])
              .domain(data.map((d) => d.Shape))
              .padding(0.2);
            svg
              .append("g")
              .attr("transform", `translate(0, ${height})`)
              .call(d3.axisBottom(x))
              .selectAll("text")
              .style("font-size", "12px")
              .attr("transform", "translate(-10,0)rotate(-45)")
              .style("text-anchor", "end");

            // Add Y axis
            const y = d3.scaleLinear().domain([0, 30000]).range([height, 0]);
            svg.append("g").call(d3.axisLeft(y).tickSize(3));
            // Bars
            svg
              .selectAll("mybar")
              .data(data)
              .join("rect")
              .attr("x", (d) => x(d.Shape))
              .attr("y", (d) => y(d.Value))
              .attr("width", x.bandwidth())
              .attr("height", (d) => height - y(d.Value))
              .attr("fill", "#ffffff");
          });

          function onMouseOver(d, i) {
            d3.select(this).attr("class", "highlight");
            d3.select(this)
              .transition() // adds animation
              .duration(400)
              .attr("width", x.bandwidth() + 5)
              .attr("y", function (d) {
                return y(d.Value) - 10;
              })
              .attr("height", function (d) {
                return height - y(d.Value) + 10;
              });

            g.append("text")
              .attr("class", "val")
              .attr("x", function () {
                return x(d.Shape);
              })
              .attr("y", function () {
                return y(d.Value) - 15;
              })
              .text(function () {
                return [d.Value]; // Value of the text
              });
          }

          //mouseout event handler function
          function onMouseOut(d, i) {
            // use the text label class to remove label on mouseout
            d3.select(this).attr("class", "bar");
            d3.select(this)
              .transition() // adds animation
              .duration(400)
              .attr("width", x.bandwidth())
              .attr("y", function (d) {
                return y(d.Value);
              })
              .attr("height", function (d) {
                return height - y(d.Value);
              });

            d3.selectAll(".val").remove();
          }
        </script>

        <p>Abduction Report</p>
        <div class="report">
          <div
            class="tableauPlaceholder"
            id="viz1646309124173"
            style="position: relative"
          >
            <object
              class="tableauViz"
              style="display: none; width: 800px; height: 649px"
            >
              <param
                name="host_url"
                value="https%3A%2F%2Fpublic.tableau.com%2F"
              />
              <param name="embed_code_version" value="3" />
              <param name="site_root" value="" />
              <param name="name" value="total_16463086574710&#47;Sheet2" />
              <param name="tabs" value="no" />
              <param name="toolbar" value="yes" />
              <param name="animate_transition" value="yes" />
              <param name="display_static_image" value="yes" />
              <param name="display_spinner" value="yes" />
              <param name="display_overlay" value="yes" />
              <param name="display_count" value="yes" />
              <param name="language" value="en-US" />
              <param name="filter" value="publish=yes" />
            </object>
          </div>
          <script type="text/javascript">
            var divElement = document.getElementById("viz1646309124173");
            var vizElement = divElement.getElementsByTagName("object")[0];
            vizElement.style.width = 800;
            vizElement.style.height = divElement.offsetWidth * 0.75 + "px";
            var scriptElement = document.createElement("script");
            scriptElement.src =
              "https://public.tableau.com/javascripts/api/viz_v1.js";
            vizElement.parentNode.insertBefore(scriptElement, vizElement);
          </script>
        </div>

        <p>Freqency of Year Reported</p>
        <div class="date">
          <div
            class="tableauPlaceholder"
            id="viz1646308668234"
            style="position: relative"
          >
            <object
              class="tableauViz"
              style="display: none; width: 800px; height: 649px"
            >
              <param
                name="host_url"
                value="https%3A%2F%2Fpublic.tableau.com%2F"
              />
              <param name="embed_code_version" value="3" />
              <param name="site_root" value="" />
              <param name="name" value="total_16463086574710&#47;Sheet1" />
              <param name="tabs" value="no" />
              <param name="toolbar" value="yes" />
              <param name="animate_transition" value="yes" />
              <param name="display_static_image" value="yes" />
              <param name="display_spinner" value="yes" />
              <param name="display_overlay" value="yes" />
              <param name="display_count" value="yes" />
              <param name="language" value="en-US" />
              <param name="filter" value="publish=yes" />
            </object>
          </div>
          <script type="text/javascript">
            var divElement = document.getElementById("viz1646308668234");
            var vizElement = divElement.getElementsByTagName("object")[0];
            vizElement.style.width = 800;
            vizElement.style.height = divElement.offsetWidth * 0.75 + "px";
            var scriptElement = document.createElement("script");
            scriptElement.src =
              "https://public.tableau.com/javascripts/api/viz_v1.js";
            vizElement.parentNode.insertBefore(scriptElement, vizElement);
          </script>
        </div>
        <br />

        <div class="scroll-page" id="page-4">
          <p>Get Me Abducted</p>
          <iframe
            width="560"
            height="315"
            display="block"
            src="https://www.youtube.com/embed/PfPdYYsEfAE"
            title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          ></iframe>
        </div>
      </div>
    </div>
    <script>
      var map = d3.select("#chart").append("svg").append("g");

      function interpolate(color1, color2, fraction) {
        var red = Math.round(
          parseInt(color1.slice(1, 3), 16) +
            fraction *
              (parseInt(color2.slice(1, 3), 16) -
                parseInt(color1.slice(1, 3), 16))
        ).toString(16);
        var grn = Math.round(
          parseInt(color1.slice(3, 5), 16) +
            fraction *
              (parseInt(color2.slice(3, 5), 16) -
                parseInt(color1.slice(3, 5), 16))
        ).toString(16);
        var blu = Math.round(
          parseInt(color1.slice(5, 7), 16) +
            fraction *
              (parseInt(color2.slice(5, 7), 16) -
                parseInt(color1.slice(5, 7), 16))
        ).toString(16);

        if (red.length < 2) red = "0" + red;
        if (grn.length < 2) grn = "0" + grn;
        if (blu.length < 2) blu = "0" + blu;

        return "#" + red.toString(16) + grn.toString(16) + blu.toString(16);
      }

      var data = d3
        .csv("https://480xfinal.s3.us-east-2.amazonaws.com/nuforc_reports.csv")
        .then(function (data) {
          var summary = [];
          var city = [];
          var state = [];
          var date_time = [];
          var shape = [];
          var duration = [];
          var stats = [];
          var report_link = [];
          var text = [];
          var posted = [];
          var city_latitude = [];
          var city_longitude = [];
          var reports = [];

          console.log(data[0]);
          // first step: convert everything to the format we want and get counts by state and city
          // we'll do this the dumb way, and it needs to be indexed by state names as opposed to abbreviation
          var sightingsByState = {};
          var sightingsByCity = {};

          var sightingsByStatePerCapita = {};

          for (let j = 0; j < data.length; j++) {
            if (sightingsByState[data[j].state])
              sightingsByState[data[j].state]++;
            else sightingsByState[data[j].state] = 1;

            if (sightingsByCity[data[j].city]) sightingsByCity[data[j].city]++;
            else sightingsByCity[data[j].city] = 1;
          }

          for (var key in sightingsByState) {
            if (attr_state_convert[key])
              sightingsByStatePerCapita[key] =
                sightingsByState[key] / census_pop[attr_state_convert[key]];
          }

          var maxSightingsByState = Math.max(
            ...Object.values(sightingsByState)
          );
          console.log(sightingsByStatePerCapita);

          var maxSightingsByStatePerCapita = Math.max(
            ...Object.values(sightingsByStatePerCapita)
          );
          console.log(maxSightingsByStatePerCapita);

          // second step: perform actual drawing
          var mapSVG = d3.select("#mapsvg1");

          var mapSVG2 = d3.select("#mapsvg2");

          var path = d3.geoPath();

          d3.json("https://d3js.org/us-10m.v2.json").then((world) => {
            mapSVG
              .append("g")
              .selectAll("path")
              .data(topojson.feature(world, world.objects.states).features)
              .enter()
              .append("path")
              .attr("d", path)
              .attr("fill", (d) => {
                return interpolate(
                  "#ffffff",
                  "#ff0000",
                  sightingsByState[state_attr_convert[d.properties.name]] /
                    maxSightingsByState
                );
              })
              .on("mouseover", (e, d) => {
                mapMouseover.transition().duration(50).style("opacity", 1.0);

                mapMouseover
                  .html(
                    d.properties.name +
                      "<br />" +
                      "Sightings: " +
                      sightingsByState[state_attr_convert[d.properties.name]]
                  )
                  .style("left", e.pageX + 10 + "px")
                  .style("top", e.pageY - 15 + "px");
              })
              .on("mouseout", (e, d) => {
                mapMouseover.transition().duration(50).style("opacity", 0.0);
              });

            mapSVG2
              .append("g")
              .selectAll("path")
              .data(topojson.feature(world, world.objects.states).features)
              .enter()
              .append("path")
              .attr("d", path)
              .attr("fill", (d) => {
                return interpolate(
                  "#ffffff",
                  "#ff0000",
                  sightingsByStatePerCapita[
                    state_attr_convert[d.properties.name]
                  ] / maxSightingsByStatePerCapita
                );
              })
              .on("mouseover", (e, d) => {
                mapMouseover.transition().duration(50).style("opacity", 1.0);

                mapMouseover
                  .html(
                    d.properties.name +
                      "<br />" +
                      "Sightings per 10000 people: " +
                      (
                        10000 *
                        sightingsByStatePerCapita[
                          state_attr_convert[d.properties.name]
                        ]
                      )
                        .toString()
                        .substring(0, 4)
                  )
                  .style("left", e.pageX + 10 + "px")
                  .style("top", e.pageY - 15 + "px");
              })
              .on("mouseout", (e, d) => {
                mapMouseover.transition().duration(50).style("opacity", 0.0);
              });
          });

          for (i = 0; i < data.length; i++) {
            if (data[i].summary != "NA") {
              reports.push(data[i]);
            }
            if (data[i].city != "NA") {
              reports.push(data[i]);
            }
            if (data[i].state != "NA") {
              reports.push(data[i]);
            }
            if (data[i].date_time != "NA") {
              reports.push(data[i]);
            }
            if (data[i].shape != "NA") {
              reports.push(data[i]);
            }
            if (data[i].duration != "NA") {
              reports.push(data[i]);
            }
            if (data[i].stats != "NA") {
              reports.push(data[i]);
            }
            if (data[i].report_link != "NA") {
              reports.push(data[i]);
            }
            if (data[i].text != "NA") {
              reports.push(data[i]);
            }
            if (data[i].posted != "NA") {
              reports.push(data[i]);
            }
            if (data[i].city_latitude != "NA") {
              reports.push(data[i]);
            }
            if (data[i].city_longitude != "NA") {
              reports.push(data[i]);
            }
          }
        });
    </script>
  </body>
</html>
